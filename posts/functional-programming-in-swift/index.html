<!DOCTYPE html><html lang="tw"><head><meta charset="UTF-8"/><meta name="og:site_name" content="李昇輯"/><link rel="canonical" href="http://localhost:8000/posts/functional-programming-in-swift"/><meta name="twitter:url" content="http://localhost:8000/posts/functional-programming-in-swift"/><meta name="og:url" content="http://localhost:8000/posts/functional-programming-in-swift"/><title>Functional Programming in Swift | 李昇輯</title><meta name="twitter:title" content="Functional Programming in Swift | 李昇輯"/><meta name="og:title" content="Functional Programming in Swift | 李昇輯"/><meta name="description" content="Functional programming in Swift."/><meta name="twitter:description" content="Functional programming in Swift."/><meta name="og:description" content="Functional programming in Swift."/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/base-min.css" type="text/css"/><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/grids-responsive-min.css" type="text/css"/><link rel="stylesheet" href="/styles.css" type="text/css"/><link rel="stylesheet" href="/syntax.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to 李昇輯"/></head><body><div class="pure-g"><div class="sidebar pure-u-1 pure-u-md-1-5"><h1><a class="theme" href="/">李昇輯</a></h1><h2>iOS Developer</h2><p>Taipei, Taiwan</p><p><a class="theme" href="https://github.com/Jimmy-Lee">github</a></p><p><a class="theme" href="https://www.linkedin.com/in/%E6%98%87%E8%BC%AF-%E6%9D%8E-8a5340112/">linkedin</a></p><p><a class="theme" href="https://twitter.com/jimmy_prime">twitter</a></p><p><a class="theme" href="mailto:jimmylevelup@gmail.com">email</a></p></div><div class="content pure-u-1 pure-u-md-3-5"><h1>Functional Programming in Swift</h1><tag><a href="/tags/functional-programming">functional programming</a></tag><p class="date">2019-11-22</p><article><p>Other than OOP or POP, Swift has some functional programming ability, let's explore some.</p><p>Let's say we are working on a image processing framework. We have a bunch of filters that operate on a <code>Image</code> type.</p><pre><code><span class="keyword">func</span> blur(radius: <span class="type">CGFloat</span> = <span class="number">1</span>, <span class="keyword">_</span> image: <span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }

<span class="keyword">func</span> erosion(strength: <span class="type">CGFloat</span> = <span class="number">1</span>, <span class="keyword">_</span> image: <span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }

<span class="keyword">func</span> reduceNoise(level: <span class="type">CGFloat</span> = <span class="number">1</span>, <span class="keyword">_</span> image: <span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }
</code></pre><p>We process an image with some filters, the code may looks like this:</p><pre><code><span class="keyword">let</span> processedImage = <span class="call">reduceNoise</span>(<span class="call">erosion</span>(<span class="call">blur</span>(image)))
</code></pre><p>If we want non default arguments, the code becomes:</p><pre><code><span class="keyword">let</span> processedImage = <span class="call">reduceNoise</span>(level: <span class="number">0.2</span>, <span class="call">erosion</span>(strength: <span class="number">3</span>, <span class="call">blur</span>(radius: <span class="number">5</span>, image)))
</code></pre><p>This code is not easy to read, and we can not tell what it's trying to do at a glance. Currently this code has some problems:</p><ol><li>Functions taking multiple arguments make it hard to modify. It is not so easy to reorder the filters.</li><li>Order of the written code is reverse to operating order. Code is written left to right, but operation occurs from inner to outer.</li></ol><p>To solve the first problem, we can use a technique called Currying to rewrite filter functions.</p><p>From <a href="https://en.wikipedia.org/wiki/Currying">Wikipedia</a>:</p><blockquote><p>In mathematics and computer science, currying is the technique of translating the evaluation of a function that takes multiple arguments into evaluating a sequence of functions, each with a single argument.</p></blockquote><p>Now we can rewrite curried version of filter functions:</p><pre><code><span class="keyword">func</span> blur(radius: <span class="type">CGFloat</span> = <span class="number">1</span>) -&gt; (<span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }

<span class="keyword">func</span> erosion(strength: <span class="type">CGFloat</span> = <span class="number">1</span>) -&gt; (<span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }

<span class="keyword">func</span> reduceNoise(level: <span class="type">CGFloat</span> = <span class="number">1</span>) -&gt; (<span class="type">Image</span>) -&gt; <span class="type">Image</span> { ... }
</code></pre><p>The image processing code can be rewritten as:</p><pre><code><span class="keyword">let</span> processedImage = <span class="call">reduceNoise</span>(level: <span class="number">0.2</span>)(<span class="call">erosion</span>(strength: <span class="number">3</span>)(<span class="call">blur</span>(radius: <span class="number">5</span>)(image)))
</code></pre><p>A bit better, but not enough improvement. To solve the second problem, we are finally getting into the functional part of Swift. We can define an operator the reverse function call, from <code>f(x)</code> to <code>x operator f</code></p><pre><code>precedencegroup <span class="type">PipeForward</span> {
    associativity: left
}

infix operator |&gt;: <span class="type">PipeForward</span>

<span class="keyword">func</span> |&gt; &lt;I, O&gt;(x: <span class="type">I</span>, f: (<span class="type">I</span>) -&gt; <span class="type">O</span>) -&gt; <span class="type">O</span> {
    <span class="call">f</span>(x) <span class="comment">// x |&gt; f</span>
}
</code></pre><p>Now the code becomes:</p><pre><code><span class="keyword">let</span> processedImage = image
    |&gt; <span class="call">blur</span>(radius: <span class="number">3</span>)
    |&gt; <span class="call">erosion</span>(strength: <span class="number">3</span>)
    |&gt; <span class="call">reduceNoise</span>(level: <span class="number">0.2</span>)
</code></pre><p>Intent of this code is very clear and very readable.</p><p>If this series of filters were repeated alot, we don't want to repeat everytime, how can we reuse this code?</p><p>From a imperative programming world, we might define another function to do the job.</p><pre><code><span class="keyword">func</span> myFilter() -&gt; (<span class="type">Image</span>) -&gt; <span class="type">Image</span> {
    { $0 |&gt; <span class="call">blur</span>(radius: <span class="number">3</span>) |&gt; <span class="call">erosion</span>(strength: <span class="number">3</span>) |&gt; <span class="call">reduceNoise</span>(level: <span class="number">0.2</span>) }
}

<span class="keyword">let</span> processedImage = image |&gt; <span class="call">myFilter</span>()
</code></pre><p>But in functional world, function is no other than variables, we can define a function that represent a combination of functions. We can do this in Swift by introducing another operator.</p><pre><code>precedencegroup <span class="type">Composition</span> {
    associativity: left
}

infix operator &gt;&gt;&gt;: <span class="type">Composition</span>

<span class="keyword">func</span> &gt;&gt;&gt; &lt;I, M, O&gt;(f: <span class="keyword">@escaping</span> (<span class="type">I</span>) -&gt; <span class="type">M</span>, g: <span class="keyword">@escaping</span> (<span class="type">M</span>) -&gt; <span class="type">O</span>) -&gt; (<span class="type">I</span>) -&gt; <span class="type">O</span> {
    { $0 |&gt; f |&gt; g } <span class="comment">// this is equivalent to g(f($0))</span>
}
</code></pre><p>So, we can write <code>myFilter</code> as:</p><pre><code><span class="keyword">let</span> myFilter = <span class="call">blur</span>(radius: <span class="number">3</span>) &gt;&gt;&gt; <span class="call">erosion</span>(strength: <span class="number">3</span>) &gt;&gt;&gt; <span class="call">reduceNoise</span>(level: <span class="number">0.2</span>)
<span class="keyword">let</span> processedImage = image |&gt; myFilter
</code></pre><p>That's it, nice and clean.</p></article></div><footer><p>Generated using <a href="https://github.com/johnsundell/publish">Publish</a></p><p><a href="/feed.rss">RSS feed</a></p></footer></div></body></html>